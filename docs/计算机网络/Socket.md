# Socket

## Socket是什么呢？

Socket是应用层与TCP/IP协议族通信的中间软件抽象层，它是一组接口。在设计模式中，Socket其实就是一个门面模式，它把复杂的TCP/IP协议族隐藏在Socket接口后面，对用户来说，一组简单的接口就是全部，让Socket去组织数据，以符合指定的协议。


## 1. 网络中进程之间如何通信？
我们要讨论的是网络中进程之间如何通信？首要解决的问题是如何唯一标识一个进程，否则通信无从谈起！

在本地可以通过进程PID来唯一标识一个进程，但是在网络中这是行不通的。

其实TCP/IP协议族已经帮我们解决了这个问题，网络层的“ip地址”可以唯一标识网络中的主机，而传输层的“协议+端口”可以唯一标识主机中的应用程序（进程）。

这样利用三元组（ip地址，协议，端口）就可以标识网络的进程了，网络中的进程通信就可以利用这个标志与其它进程进行交互。


## 2. 什么是Socket？
上面我们已经知道网络中的进程是通过socket来通信的，那什么是socket呢？socket起源于Unix，而Unix/Linux基本哲学之一就是“一切皆文件”，都可以用“打开open –> 读写write/read –> 关闭close”模式来操作。我的理解就是Socket就是该模式的一个实现，socket即是一种特殊的文件，一些socket函数就是对其进行的操作（读/写IO、打开、关闭），这些函数我们在后面进行介绍。


## 3. socket的基本操作
既然socket是“open—write/read—close”模式的一种实现，那么socket就提供了这些操作对应的函数接口。


## 4. socket中TCP的三次握手建立连接详解
- [参考](https://blog.csdn.net/pashanhu6402/article/details/96428887)

我们知道tcp建立连接要进行“三次握手”，即交换三个分组。大致流程如下：

    - 客户端向服务器发送一个SYN J
    - 服务器向客户端响应一个SYN K，并对SYN J进行确认ACK J+1
    - 客户端再想服务器发一个确认ACK K+1


只有就完了三次握手，但是这个三次握手发生在socket的那几个函数中

    从图中可以看出，当客户端调用connect时，触发了连接请求，向服务器发送了SYN J包，这时connect进入阻塞状态；
    服务器监听到连接请求，即收到SYN J包，调用accept函数接收请求向客户端发送SYN K ，ACK J+1，这时accept进入阻塞状态；
    客户端收到服务器的SYN K ，ACK J+1之后，这时connect返回，并对SYN K进行确认；
    服务器收到ACK K+1时，accept返回，至此三次握手完毕，连接建立。



## 5. socket中TCP的四次握手释放连接详解

过程如下：

    某个应用进程首先调用close主动关闭连接，这时TCP发送一个FIN M；

    另一端接收到FIN M之后，执行被动关闭，对这个FIN进行确认。它的接收也作为文件结束符传递给应用进程，因为FIN的接收意味着应用进程在相应的连接上再也接收不到额外数据；

    一段时间之后，接收到文件结束符的应用进程调用close关闭它的socket。这导致它的TCP也发送一个FIN N；

    接收到这个FIN的源发送端TCP对它进行确认。

这样每个方向上都有一个FIN和ACK。