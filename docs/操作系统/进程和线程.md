# 进程和线程
- 参考课本

- [参考链接1](https://blog.csdn.net/sunxianghuang/article/details/51883496)

## 进程
- 进程是一个可并发执行的应用程序关于某个数据集合的一次执行过程

- 它是操作系统进程资源分配和保护的基本单位



## 线程
- 线程是进程的一部分，它是进程内的一个执行体

- 线程是比进程更小的能独立运行的基本单位


## 为什么要引入线程

- 操作系统引入进程的目的是为了使多个程序并发执行，以提高资源的利用率和系统的吞吐量

- 而操作系统引入线程的目的是为了减少程序并发执行是所付出的时空开销，使得操作系统有更好的并发性


## 二者的区别和联系
- 一个进程包含有多个线程，至少有一个线程

- 一个进程的多个线程都在进程的地址空间里活动

- 在引入线程的操作系统里，资源分配的对象是进程，而不是线程。进程仍然是拥有资源的一个独立单位，它拥有自己的资源。而线程除了一点必不可少的资源外不拥有系统资源，线程使用的是进程分到的资源

- 在引入操作线程的操作系统里面，调度的基本单位是线程而不是进程，即在CPU上执行的是线程。

- 进程可以并发执行，进程中的线程也可以并发执行，同时需要协作同步

- 进程调度系统需要进程上下文的切换，需要大量的开销

- 线程调度，由于统一进程的线程使用的是共享进程的资源，所以线程切换比进程切换更快

- 一个进程的线程切换到另一个进程的线程，会引起进程的上下文切换

- 从安全角度说，进程比线程安全

- 通信：进程间 以IPC（管道，信号量，共享内存，消息队列，文件，套接字等）方式通信。同一个进程下，线程间可以共享全局变量、静态变量等数据进行通信，做到同步和互斥，以保证数据的一致性

- 执行过程：每个进程都有一个程序执行的入口，顺序执行序列；线程不能够独立执行，必须依存在应用程序中，由程序的多线程控制机制控制

- 健壮性：每个进程之间的资源是独立的，当一个进程崩溃时，不会影响其他进程；同一进程的线程共享此线程的资源，当一个线程发生崩溃时，此进程也会发生崩溃，稳定性差，容易出现共享与资源竞争产生的各种问题，如死锁等

- 可维护性：线程的可维护性，代码也较难调试，bug 难排查

## 进程和线程的选择
- 需要频繁创建销毁的优先使用线程。因为进程创建、销毁一个进程代价很大，需要不停的分配资源；线程频繁的调用只改变 CPU 的执行

- 线程的切换速度快，需要大量计算，切换频繁时，用线程
- 耗时的操作使用线程可提高应用程序的响应
- 线程对 CPU 的使用效率更优，多机器分布的用进程，多核分布用线程

- 需要跨机器移植，优先考虑用进程
- 需要更稳定、安全时，优先考虑用进程
- 需要速度时，优先考虑用线程
- 并行性要求很高时，优先考虑用线程


## 进程的通信
- [参考链接](https://zhuanlan.zhihu.com/p/86629244)

进程通信，是指进程之间的信息交换（信息量少则一个状态或数值，多者则是成千上万个字节）。

因此，对于用信号量进行的进程间的互斥和同步，由于其所交换的信息量少而被归结为低级通信。
所谓高级进程通信指：用户可以利用操作系统所提供的一组通信命令传送大量数据的一种通信方式。
操作系统隐藏了进程通信的实现细节。

高级通信机制可归结为三大类：
1. 共享存储器系统（存储器中划分的共享存储区）
> 实际操作中对应的是“剪贴板”（剪贴板实际上是系统维护管理的一块内存区域）的通信方式，
>比如举例如下：word进程按下ctrl+c，在ppt进程按下ctrl+v，即完成了word进程和ppt进程之间的通信，
>复制时将数据放入到剪贴板，粘贴时从剪贴板中取出数据，然后显示在ppt窗口上


2. 消息传递系统（进程间的数据交换以消息（message）为单位，
当今最流行的微内核操作系统中，微内核与服务器之间的通信，无一例外地都采用了消息传递机制。
> 应用举例：邮槽（MailSlot）是基于广播通信体系设计出来的，它采用无连接的不可靠的数据传输。
> 邮槽是一种单向通信机制，创建邮槽的服务器进程读取数据，打开邮槽的客户机进程写入数据

3. 管道通信系统（管道即：连接读写进程以实现他们之间通信的共享文件
（pipe文件，类似先进先出的队列，由一个进程写，另一进程读））。
> 实际操作中，管道分为：匿名管道、命名管道。匿名管道是一个未命名的、单向管道，通过父进程和一个子进程之间传输数据。
>匿名管道只能实现本地机器上两个进程之间的通信，而不能实现跨网络的通信。
>命名管道不仅可以在本机上实现两个进程间的通信，还可以跨网络实现两个进程间的通信

进程间通讯的方式:
管道：管道是单向的、先进先出的、无结构的、固定大小的字节流，它把一个进程的标准输出和另一个进程的标准输入连接在一起。写进程在管道的尾端写入数据，读进程在管道的道端读出数据。数据读出后将从管道中移走，其它读进程都不能再读到这些数据。管道提供了简单的流控制机制。进程试图读空管道时，在有数据写入管道前，进程将一直阻塞。同样地，管道已经满时，进程再试图写管道，在其它进程从管道中移走数据之前，写进程将一直阻塞。

信号量：信号量是一个计数器，可以用来控制多个进程对共享资源的访问。它常作为一种锁机制，防止某进程正在访问共享资源时，其它进程也访问该资源。因此，主要作为进程间以及同一进程内不同线程之间的同步手段

消息队列：是一个在系统内核中用来保存消 息的队列，它在系统内核中是以消息链表的形式出现的。消息队列克服了信号传递信息少、管道只能承载无格式字节流以及缓冲区大小受限等缺点

共享内存：共享内存允许两个或多个进程访问同一个逻辑内存。这一段内存可以被两个或两个以上的进程映射至自身的地址空间中，一个进程写入共享内存的信息，可以被其他使用这个共享内存的进程，通过一个简单的内存读取读出，从而实现了进程间的通信。如果某个进程向共享内存写入数据，所做的改动将立即影响到可以访问同一段共享内存的任何其他进程。共享内存是最快的IPC方式，它是针对其它进程间通信方式运行效率低而专门设计的。它往往与其它通信机制（如信号量）配合使用，来实现进程间的同步和通信

套接字：套接字也是一种进程间通信机制，与其它通信机制不同的是，它可用于不同机器间的进程通信