# Redis

- [官网](redis.io)

## Redis 是什么
- redis是一个开源的、使用C语言编写的、支持网络交互的、可基于内存、可持久性的 Key-Value 数据库。它通常被称为数据结构服务器。

    1. 基于内存运行
    2. 支持分布式，理论上可以无限扩展
    3. key - value 存储系统
    4. 开源的使用ANSI C语言编写、遵守BSD协议、支持网络、可基于内存亦可持久化的日志型、Key-Value数据库，并提供多种语言的API

- 相比于其他的数据库，redis 具备的特点是：
    - C/S通讯模型
    - 单进程单线程模型
    - 丰富的数据类型
    - 操作具有原子性
    - 持久化
    - 高并发读写
    - 支持lua脚本

- Redis 的应用场景包括：
    - 缓存系统（“热点”数据：高频读、低频写）、
    - 计数器、
    - 消息队列系统、
    - 排行榜、
    - 社交网络和实时系统。

### Redis简介
- redis是一个高性能的 key-value数据库，相比其他的key-value缓存产品有以下三个特点
    
    - 支持数据的持久化，可以将内存中的数据保存在磁盘中，重启的时候可以再次加载进行使用
    - 不仅仅支持简单的key-value 类型的数据，同时还提供 list, set, zset, hash等数据结构的存储
    - redis 支持数据的备份，即master- slave模式的数据备份

### Redis优势
- 性能极高: Redis能读的速度是110000次/s,写的速度是81000次/s 。
- 丰富的数据类型: Redis支持二进制案例的 Strings, Lists, Hashes, Sets 及 Ordered Sets 数据类型操作。
- 原子 – Redis的所有操作都是原子性的，意思就是要么成功执行要么失败完全不执行。单个操作是原子性的。多个操作也支持事务，即原子性，通过MULTI和EXEC指令包起来。
- 丰富的特性 – Redis还支持 publish/subscribe, 通知, key 过期等等特性。



## Redis数据结构
- redis 是一种高级的 key:value 存储系统，其中value 支持五种类型的数据

    1. 字符串(strings)
    2. 列表(lists)
    3. 集合(sets)
    4. 哈希/散列(hashes)
    5. 有序集合（sorted sets/zsets）

- 关于key
    1. 尽量不要超过1024字节，这不仅消耗内存，而且会降低查找的效率；
    2. key也不要太短，太短的话，key的可读性会降低；
    3. 在一个项目中，key最好使用统一的命名模式，例如user:10000:passwd。


### strings
- 它是一个二进制安全的字符串，意味着它不仅能够存储字符串，还能存储图片、视频等多种类型。string 类型的值最大能存储 512MB。


### Hash
- Redis hash 是一个键值(key -> value)集合
- Redis hash 是一个string 类型的field 和 value的映射表，适合用于存储对象。
- 每个 hash 可以存储 2^32 -1 键值对（40多亿）。

### List
- Redis列表是简单的字符串列表，按照插入顺序排序，你可以添加一个元素到列表的头部(左边) 或者尾部(右边)。相当于一个 双向链表

- 列表最多可存储 2^32 - 1 元素 (4294967295, 每个列表可存储40多亿)

### Set
- Redis的Set 是string类型的无序集合
- 集合是通过哈希表实现的，所以添加，删除，查找的复杂度都是O(1)
- sadd 命令：
    - sadd key member
    - 添加一个string元素到 key 对应的set 集合中，成功返回1，如果元素已经存在 则返回 0
- 集合中最大的成员数为 2^32 -1


### zset(sorted set: 有序集合)
- zset 和 set 一样是string类型元素的集合，并且不允许重复的成员
- 不同的是，每个元素都会关联一个 double 类型的分数。而redis 正是通过分数来为集合中的成员进行从小到大的排序。
- zset 的成员是唯一的，但是分数(score)是可以重复的。

- zadd命令
    - zadd key score member 
    - 添加元素到集合，如果元素在集合中已经存在，则更新score


### 各个数据类型应用场景总结:
- string：

    - 简介：二进制安全
    - 特性：可以包含任何数据,比如jpg图片或者序列化的对象,一个键最大能存储512M

- Hash字典：

    - 简介：键值对集合,即编程语言中的Map类型
    - 特性：适合于存储对象，并且可以像数据库中 update一个熟悉一样 只修改某一项属性值
    - 场景：存储、读取、修改用户属性

- List列表：

    - 简介：链表(双向链表)
    - 特性：增删块，提供了 操作某一段元素的 API
    - 场景：
        1. 最新消息排行等功能(比如朋友圈的时间线) 
        2. 消息队列

- set集合：

    - 简介：哈希表实现，元素不重复
    - 特性：
        1. 添加、删除、查找的复杂度都是O(1)
        2. 为集合提供了求交集、并集、差集等操作
    - 场景：
        1. 共同好友
        2. 利用唯一性，统计访问网站的所有独立ip
        3. 好友推荐时，根据tag求交集，大于某个阈值 则可以推荐

- zset/sorted set(有序集合)
    - 简介：给set中的元素添加一个 权重参数 score，元素按照 score有序排序
    - 特性：数据插入集合时，已经进入天然排序
    - 场景：
        1. 排行榜
        2. 带权重的消息队列


### 其他
- 注意：Redis支持多个数据库，并且每个数据库的数据是隔离的不能共享，并且基于单机才有，如果是集群就没有数据库的概念。
- Redis是一个字典结构的存储服务器，而实际上一个Redis实例提供了多个用来存储数据的字典，客户端可以指定将数据存储在哪个字典中。这与我们熟知的在一个关系数据库实例中可以创建多个数据库类似，所以可以将其中的每个字典都理解成一个独立的数据库
- 个数据库对外都是一个从0开始的递增数字命名，Redis默认支持16个数据库（可以通过配置文件支持更多，无上限），可以通过配置databases来修改这一数字。客户端与Redis建立连接后会自动选择0号数据库，不过可以随时使用SELECT命令更换数据库，如要选择1号数据库： SELECT 1

- 然而这些以数字命名的数据库又与我们理解的数据库有所区别。首先Redis不支持自定义数据库的名字，每个数据库都以编号命名，开发者必须自己记录哪些数据库存储了哪些数据。另外Redis也不支持为每个数据库设置不同的访问密码，所以一个客户端要么可以访问全部数据库，要么连一个数据库也没有权限访问.
- 最重要的一点是多个数据库之间并不是完全隔离的，比如FLUSHALL命令可以清空一个Redis实例中所有数据库中的数据
- 综上所述，这些数据库更像是一种命名空间，而不适宜存储不同应用程序的数据。比如可以使用0号数据库存储某个应用生产环境中的数据，使用1号数据库存储测试环境中的数据，但不适宜使用0号数据库存储A应用的数据而使用1号数据库B应用的数据，不同的应用应该使用不同的Redis实例存储数据.
- 由于Redis非常轻量级，一个空Redis实例占用的内在只有1M左右，所以不用担心多个Redis实例会额外占用很多内存。




## Redus 持久化
- Redis提供了两种持久化的方式，分别是RDB(Redis DataBase) 个AOF(Append Only File)。
- RDB: 简单来说就是，就是在不同的时间点，将redis 存储的数据生成快照 并存储到磁盘等介质上。
- AOF: 是将 redis执行过的 所有写指令记录下来，在下次redis 重新启动的时候，只要把这些写指令从前往后 再重复执行一次，就可以实现数据恢复

- 两种方式可以同时使用。这种情况下，如果redis重启的话，会优先采用AOF方式来进行数据恢复，因为AOF方式的数据恢复完整度更高。
- 当然也可以都不适用，那么redis就变成了一个纯内存数据库，就像memcache一样。

